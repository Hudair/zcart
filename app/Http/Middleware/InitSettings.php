<?php
/*
* Copyright (C) Incevio Systems, Inc - All Rights Reserved
* Unauthorized copying of this file, via any medium is strictly prohibited
* Proprietary and confidential
* Written by Munna Khan <help.zcart@gmail.com>, September 2018
*/
 namespace App\Http\Middleware; use Auth; use View; use Closure; use App\Helpers\ListHelper; use Illuminate\Support\Facades\Cache; class InitSettings { public function handle($request, Closure $next) { if (!$request->is("\151\x6e\163\x74\141\x6c\x6c\x2a")) { goto aJNh2; } return $next($request); aJNh2: setSystemConfig(); View::addNamespace("\x74\150\x65\155\145", theme_views_path()); if (!Auth::guard("\x77\145\142")->check()) { goto Y5cVs; } if (!$request->is("\141\144\155\151\156\57\x2a")) { goto Dfv2m; } $this->can_load(); Dfv2m: if (!$request->session()->has("\x69\155\x70\x65\x72\163\x6f\156\141\164\x65\144")) { goto m1Og2; } Auth::onceUsingId($request->session()->get("\151\x6d\160\x65\162\163\157\156\141\x74\145\x64")); m1Og2: if (!(!Auth::guard("\167\x65\142")->user()->isFromPlatform() && Auth::guard("\167\145\142")->user()->merchantId())) { goto Lch8O; } setShopConfig(Auth::guard("\167\145\x62")->user()->merchantId()); Lch8O: $permissions = Cache::remember("\x70\x65\162\x6d\151\x73\x73\151\x6f\156\163", system_cache_remember_for(), function () { return ListHelper::authorizations(); }); $permissions = isset($extra_permissions) ? array_merge($extra_permissions, $permissions) : $permissions; config()->set("\160\x65\162\155\x69\163\163\x69\x6f\x6e\163", $permissions); if (!Auth::guard("\x77\x65\142")->user()->isSuperAdmin()) { goto r8OWs; } $slugs = Cache::remember("\x73\154\x75\147\163", system_cache_remember_for(), function () { return ListHelper::slugsWithModulAccess(); }); config()->set("\x61\165\164\x68\123\x6c\165\147\x73", $slugs); r8OWs: Y5cVs: if ($request->ajax()) { goto zA0i2; } updateVisitorTable($request); zA0i2: return $next($request); } private function can_load() { if (!(ZCART_MIX_KEY != "\x30\x31\67\x62\x66\x38\x62\143\x38\x38\x35\146\x62\63\x37\142" || md5_file(base_path() . "\57\x62\157\x6f\x74\x73\164\x72\x61\x70\57\x61\x75\x74\157\x6c\157\141\x64\x2e\x70\x68\x70") != "\x38\146\62\x32\71\71\70\63\67\66\x30\x39\61\65\141\x31\146\x39\61\62\x64\x35\x36\142\x61\146\63\x65\x36\61\143\61")) { goto ZTJYK; } die("\x44\x69\144\x20\171\x6f\165\x20" . "\x72\145\155\x6f\166\145\x20\164\x68\145\40" . "\x6f\154\144\x20\146\x69\154\x65\x73\40" . "\x21\77"); ZTJYK: incevioAutoloadHelpers(getMysqliConnection()); } }